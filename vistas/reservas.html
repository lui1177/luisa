<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <title>Boutique Angels</title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="Free HTML Templates" name="keywords">
        <meta content="Free HTML Templates" name="description">
    
        <!-- Favicon -->
        <link href="img/favicon.ico" rel="icon">
    
        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
        <!-- Font Awesome -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    
        <!-- Libraries Stylesheet -->
        <link href="lib/animate/animate.min.css" rel="stylesheet">
        <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
        <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />
        
    
        <!-- Customized Bootstrap Stylesheet -->
        <link href="/css/style.css" rel="stylesheet">
        <link href="/css/cotizar/coti.css" rel="stylesheet">
    
        <style>
            .whatsapp-btn {
        position: fixed;
        left: 20px;
        bottom: 20px;
        background-color: #25d366;
        color: white;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        text-decoration: none;
    }
    
    .whatsapp-btn img {
        width: 35px;
        height: 35px;
    }
    
        </style>
    </head>
    
    <body> 
        <a href="https://wa.me/573133670007" class="whatsapp-btn" target="_blank">
            <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
        </a>
        <div class="container-fluid p-0">
            <nav class="navbar navbar-expand-lg bg-white navbar-light py-3 py-lg-0 px-lg-5">
                <img src="/img/Logoo.jpg" alt="Logo" style="width: 130px; height: auto;">
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse justify-content-between px-lg-3" id="navbarCollapse">
                    <div class="navbar-nav m-auto py-0">
                        <a href="/" class="nav-item nav-link">Inicio</a>
                        <a href="eventos.html" class="nav-item nav-link">Eventos</a>
                        <a href="servicios.html" class="nav-item nav-link">Servicios</a>
                        <a href="/cotizar" class="nav-item nav-link">Cotizar</a>
                    </div>
                    <span id="user-names" class="navbar-text d-none d-lg-block" style="font-size: 1.2rem;"></span>
                    <a href="#" id="login-btn" class="btn btn-primary d-none d-lg-block">Mis reservas</a>
                    <a href="#" id="cerrar-sesion-link" class="btn cerrar-sesion d-none d-lg-block" onclick="cerrarSesion(event)">
                        <i class="fas fa-sign-out-alt"></i> Cerrar sesión </a>
                </div>
            </nav>
        </div>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Reservas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Estilos generales */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f4f8;
        }
        #login-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 180vh; 
    flex-direction: column; 
    margin: 0;
    padding: 0;
    background-color: #f4f4f4; /* Color de fondo del contenedor */
}

        h1 {
            text-align: center;
            margin: 20px 0;
            color: #333;
        }
        /* Estilos de la tabla */
        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
            background-color: #ffffff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            border: none;
            padding: 10px;
            text-align: center;
            font-size: 14px;
            transition: background-color 0.3s, transform 0.2s;
        }
        th {
            background-color: #c5a44f;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #e2e6ea;
            transform: scale(1.01);
        }
        /* Estilos de los iconos */
        .icon {
            cursor: pointer;
            margin: 0 5px;
            color: #333;
            transition: color 0.3s, transform 0.2s;
        }
        .icon:hover {
            color: #c5a44f;
            transform: scale(1.1);
        }
        /* Estilos del modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
            padding-top: 60px;
        }
        .modal-content {
            background: linear-gradient(to bottom right, #ffffff, #f0f0f0);
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            width: 50%;
            max-width: 600px;
            animation: slideIn 0.5s ease;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .close {
            color: #c5a44f;
            float: right;
            font-size: 30px;
            transition: color 0.3s;
        }
        .close:hover {
            color: #c5a44f;
            text-decoration: none;
            cursor: pointer;
        }
        /* Estilos de los formularios */
        form {
            display: flex;
            flex-direction: column;
            margin-top: 20px;
        }
        label {
            margin: 10px 0 5px;
            font-weight: bold;
            color: #333;
        }
        input[type="number"],
        input[type="text"],
        input[type="date"],
        input[type="time"],
        select {
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            margin-bottom: 15px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        input[type="number"]:focus,
        input[type="text"]:focus,
        input[type="date"]:focus,
        input[type="time"]:focus,
        select:focus {
            border-color: #c5a44f;
            box-shadow: 0 0 5px rgba(197, 164, 79, 0.5);
        }
 input[type ="submit"] {
            background-color: #c5a44f;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            font-size: 16px;
        }
        input[type="submit"]:hover {
            background-color: #c5a44f;
            transform: scale(1.05);
        }
        /* Mensaje de error */
        .error-message {
            color: red;
            font-size: 14px;
            margin-top: -10px;
            margin-bottom: 15px;
        }
        /* Estilo del botón de logout */
        #logoutButton {
            display: block;
            margin: 20px auto;
            padding: 19px 55px;
            background-color: #c5a44f;
            color: white;
            text-align: center;
            border-radius: 6px;
            text-decoration: none;
            transition: background-color 0.3s;
            font-size: 14px;
        }
        #logoutButton:hover {
            background-color: #c5a44f;
        }
       /* Estilos de la alerta */
       .alerta {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #c5a44f; /* Color dorado */
            color: black; /* Color del texto */
            border-radius: 25px; /* Bordes redondeados */
            padding: 15px 30px; /* Espaciado interno */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); /* Sombra */
            z-index: 1000; /* Asegúrate de que esté por encima de otros elementos */
            transition: opacity 0.5s ease; /* Transición suave */
            opacity: 0; /* Comienza invisible */
            visibility: hidden; /* Comienza oculto */
        }
        .alerta.show {
            opacity: 1; /* Muestra el cuadro de alerta */
            visibility: visible; /* Asegúrate de que sea visible */
        }
    </style>
</head>
<body>
    <br>
    <br>
    <div id="login-wrapper">

    <h1>Mis Reservas</h1>
    <table id="tablaReservas">
        <thead>
            <tr>
                <th>Personas</th>
                <th>Evento</th>
                <th>Fecha</th>
                <th>Hora</th>
                <th>Buffet</th>
                <th>Carne</th>
                <th>Arroz</th>
                <th>Bebida</th>
                <th>Postre</th>
                <th>Mesa Dulces</th>
                <th>Decoración</th>
                <th>Alquiler</th>
                <th>Música</th>
                <th>Total</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="cuerpoTabla">
            <!-- Las reservas se llenarán aquí -->
        </tbody>
    </table>

    <a href="index.html" id="logoutButton">Salir</a>

    <!-- Modal para editar reserva -->
    <div id="modalEditar" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Editar Reserva</h2>
            <div id="tiempoRestante" style="text-align: center; font-size: 20px; color: #c5a44f;"></div>
            <form id="formEditarReserva" style="max-width: 600px; margin: auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px; background-color: #f9f9f9;">
                
                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="personas" style="font-weight: bold;">Cantidad de Personas</label>
                    <input type="number" id="personas" name="personas" class="small-input" value="1" min="1" max="300" maxlength="3" required style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
                    <span id="personas-error" class="error-message" style="display:none; color: red;">El número máximo de personas es 300</span>
                </div>
            
                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="fecha" style="font-weight: bold;">Fecha</label>
                    <input type="date" id="fecha" name="fecha" min="2024-10-01" max="2025-12-31" required onchange="changeDateStyle()" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
            
                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="hora" style="font-weight: bold;">Hora</label>
                    <select id="hora" name="hora" required onchange="changeTimeStyle()" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
                        <option value="" disabled selected hidden>Seleccionar Hora</option>
                        <option value="18:00">6:00 PM</option>
                        <option value="19:00">7:00 PM</option>
                        <option value="20:00">8:00 PM</option>
                    </select>
                    <div id="timeError" style="color: red; display: none;">Horas disponibles solo: 6 p.m, 7 p.m o 8 p.m.</div>
                </div>
            
                <input type="hidden" id="cotizacionId" name="cotizacionId">
                <input type="submit" value="Guardar Cambios" style="width: 100%; padding: 10px; background-color: #c5a44f; color: white; border: none; border-radius: 4px; cursor: pointer;">
            </form>
        </div>
    </div>
    <div id="alerta" class="alerta">
        Reserva actualizada con éxito
    </div>
    <script>
    window.onload = function() {
        cargarReservas();
        verificarEdicionActiva();
    };
    
    function cargarReservas() {
        fetch('/reservar/mis-reservas')
            .then(response => response.json())
            .then(data => {
                const reservas = data.reservas;
                const cuerpoTabla = document.getElementById('cuerpoTabla');
                cuerpoTabla.innerHTML = '';
    
                reservas.forEach(reserva => {
                    const fila = document.createElement('tr');
                    fila.setAttribute('data-id', reserva.cotizacionId);
                    fila.innerHTML = `
                        <td>${reserva.personas}</td>
                        <td>${reserva.evento}</td>
                        <td>${reserva.fecha}</td>
                        <td>${reserva.hora}</td>
                        <td>${reserva.buffet}</td>
                        <td>${reserva.carne}</td>
                        <td>${reserva.arroz}</td>
                        <td>${reserva.bebida}</td>
                        <td>${reserva.postre}</td>
                        <td>${reserva.mesa_dulces}</td>
                        <td>${reserva.decoracion}</td>
                        <td>${reserva.alquiler}</td>
                        <td>${reserva.musica}</td>
                        <td>${reserva.total}</td>
                        <td>
                            <i class="fas fa-edit icon" onclick="abrirModal(${reserva.cotizacionId})" title="Editar reserva"></i>
                        </td>
                    `;
                    cuerpoTabla.appendChild(fila);
                });
            })
            .catch(error => console.error('Error al cargar las reservas:', error));
    }
    
    function iniciarContador(tiempoRestante) {
        const intervalo = setInterval(() => {
            const minutos = Math.floor(tiempoRestante / 60);
            const segundos = tiempoRestante % 60;
            document.getElementById('tiempoRestante').innerText = 
                `Te queda ${minutos} minutos y ${segundos} segundos para editar la reserva.`;
    
            if (tiempoRestante <= 0) {
                clearInterval(intervalo);
                document.getElementById('tiempoRestante').innerText = '¡Tiempo agotado!';
                deshabilitarEdicion(); // Deshabilitar el formulario
                localStorage.removeItem('tiempoRestante');
            } else {
                tiempoRestante--;
                localStorage.setItem('tiempoRestante', tiempoRestante);
            }
        }, 1000);
    }
    
    function deshabilitarEdicion() {
        const form = document.getElementById('formEditarReserva');
        const inputs = form.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.disabled = true;
        });
        const submitButton = form.querySelector('button[type="submit"]');
        if (submitButton) {
            submitButton.disabled = true;
        }
    }
    
    function verificarEdicionActiva() {
        const tiempoRestante = localStorage.getItem('tiempoRestante');
        if (tiempoRestante && parseInt(tiempoRestante) > 0) {
            iniciarContador(parseInt(tiempoRestante));
        }
    }
    
    function abrirModal(cotizacionId) {
        const modal = document.getElementById('modalEditar');
        const span = document.getElementsByClassName('close')[0];
        modal.style.display = "block";
    
        fetch(`/reservar/editar/${cotizacionId}`)
            .then(response => response.json())
            .then(data => {
                if (data.reserva) {
                    document.getElementById('personas').value = data.reserva.personas;
                    document.getElementById('fecha').value = data.reserva.fecha;
                    document.getElementById('hora').value = data.reserva.hora;
                    document.getElementById('cotizacionId').value = data.reserva.cotizacionId;
    
                    // Reiniciar temporizador solo si no hay tiempo restante
                    if (!localStorage.getItem('tiempoRestante') || parseInt(localStorage.getItem('tiempoRestante')) <= 0) {
                        localStorage.setItem(' tiempoRestante', 2 * 60 + 30);
                    }
    
                    iniciarContador(parseInt(localStorage.getItem('tiempoRestante')));
    
                    document.getElementById('formEditarReserva').onsubmit = function(event) {
                        event.preventDefault();
                        const personas = document.getElementById('personas').value;
                        const fecha = document.getElementById('fecha').value;
                        const hora = document.getElementById('hora').value;
                        const cotizacionId = document.getElementById('cotizacionId').value;
    
                        fetch(`/reservar/editar/${cotizacionId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ personas, fecha, hora })
                        })
                        .then(response => response.ok ? response.json() : Promise.reject('Error al actualizar la reserva'))
                        .then(data => {
                            if (data.success) {
                                // Mostrar el cuadro de alerta
                                const alerta = document.getElementById('alerta');
                                alerta.classList.add('show');
                                setTimeout(() => {
                                    alerta.classList.remove('show');
                                }, 3000);
    
                                modal.style.display = "none";
                                cargarReservas();
                                localStorage.setItem('tiempoRestante', 2 * 60 + 30); // Reiniciar temporizador para edición
                                iniciarContador();
                            }
                        })
                        .catch(error => console.error('Error al actualizar la reserva:', error));
                    };
                } else {
                    console.error('Reserva no encontrada');
                }
            })
            .catch(error => console.error('Error al obtener datos de la reserva:', error));
    }
    </script>
       <!-- Footer -->
       <div class="footer container-fluid position-relative bg-dark py-5" style="margin-top: 90px;">
        <div class="container pt-0">
            <div class="row">
                <div class="col-lg-6 pr-lg-5 mb-5">
                    <a href="index.html" class="navbar-brand">
                        <h1 class="mb-3 text-white"><span class="text-primary">Boutique</span> Angels</h1>
                    </a>
                    <p>En Boutique Angels, organizamos eventos personalizados para hacerlos inolvidables. Nuestro equipo de expertos garantiza un servicio de alta calidad, cuidando cada detalle con esmero.</p>
                    <p><i class="fa fa-map-marker-alt mr-2"></i>Paipa, Colombia</p>
                    <p><i class="fa fa-phone-alt mr-2"></i>+57 313 3670007</p>
                    <p><i class="fa fa-envelope mr-2"></i>boutique@gmail.com</p>
                    <div class="d-flex justify-content-start mt-4">
                        <a class="btn btn-lg btn-primary btn-lg-square mr-2" href="https://www.facebook.com/boutiqueangels.paipa"><i class="fab fa-facebook-f"></i></a>
                        <a class="btn btn-lg btn-primary btn-lg-square" href="https://www.instagram.com/boutique_angels_paipa"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                <div class="col-lg-6 mb-5 d-flex justify-content-center align-items-center" style="min-height: 250px;">
                    <!-- Mapa de Google -->
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3969.53961727838!2d-73.1160018162797!3d5.779167416437327!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8e6a6ba803ca3b17%3A0x6c54ce3e690ce03b!2sBoutique%20Angels%20Paipa!5e0!3m2!1ses-419!2sco!4v1727305672489!5m2!1ses-419!2sco" width="100%" height="250" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid bg-dark text-light border-top py-4" style="border-color: rgba(256, 256, 256, .15) !important;">
        <div class="container">
            <div class="row">
                <div class="col-md-6 text-center text-md-left mb-3 mb-md-0">
                    <p class="m-0 text-white">&copy; <a href="#">Boutique Angels</a>. Todos los derechos reservados.</p>
                </div>
            </div>
        </div>
    </div>
    <!-- Termina -->    
    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary back-to-top"><i class="fa fa-angle-double-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/counterup/counterup.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/tempusdominus/js/moment.min.js"></script >
    <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

    <!-- Contact Javascript File -->
    <script src="mail/jqBootstrapValidation.min.js"></script>
    <script src="mail/contact.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>

</body>
</html>